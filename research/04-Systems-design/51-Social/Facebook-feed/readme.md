## News feed (facebook)

### Initial questions related

#### Key concepts?

- User-Generated Content (UGC): All these platforms rely heavily on content created and shared by their users.

- Algorithmic Content Delivery: They all use algorithms to decide what to show in a user's feed based on factors like past user behavior, network connections, user preferences, trending topics, etc.

- Social Interaction: Each of these platforms facilitates social interaction, allowing users to like, comment on, share, and interact with the content that they see.

- Real-time Updates: All of these platforms provide near-real-time updates, with new content appearing in the feed as it is posted.

- Customization: They all offer the ability for users to customize their feeds to some extent, based on who they follow or what topics they're interested in.

- Ad-based Revenue Model: They all generate revenue by showing targeted ads to users based on their behavior, interests, and demographics.

#### Example platforms

| Platform  | Content Focus                              | Unique Features                                                                                                                                  |
| --------- | ------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| Spotify   | Music and podcasts                         | User follows artists, playlists, or friends to get updates and recommendations; "Discover Weekly" playlist.                                      |
| Facebook  | Mixed (text, photos, videos, links)        | Combines updates from friends, groups, pages; features for private messaging, groups, and events.                                                |
| Instagram | Photo and video                            | Aesthetic appeal; photo filters; Instagram Stories, IGTV, and Shopping.                                                                          |
| Twitter   | Text (also supports images, videos, links) | Character limit encourages concise messaging; real-time updates on current events; trending topics and hashtags.                                 |
| TikTok    | Short-form video                           | Users can create and share videos up to 60 seconds long; viral dance challenges; educational content; powerful content recommendation algorithm. |

#### Functionality needed?

- Account Management
- User Profile
- Posts an Content Sharing
- Feed and content discovery
- Social interactions
- Messaging
- Groups and pages
- Privacy and security
- Accessibility and usability
- Ad display

#### Main stakeholders

- End-users
- Advertiseras
- Content createors
- Employees and developers
- Regulatory authorities
- Partners
- Community and society at large

#### Initial services

- User Service: This handles user-related operations and stores user profiles, including the list of friends for each user.

- Feed Service: This is responsible for creating, storing, and retrieving feed data. Each user's feed is generated by pulling status updates from their friends and running them through a ranking algorithm.

- Real-Time Update Service: This service pushes real-time updates to users' feeds. When a user posts a status update, the Real-Time Update Service ensures that it's quickly propagated to their friends' feeds.

- Ranking Service: This service takes a list of relevant posts and ranks them to generate a user's news feed.

- Ads Service (optional): If ads are incorporated, this service will determine what ads to show to a user at any given time.

#### Sequence diagram - ver 1.0

![Feed sequence diagram](https://github.com/skirtapaieo/system-design-101/blob/main/feed-seq-diagram.png)

https://github.com/skirtapaieo/system-design-101/blob/main/feed-seq-diagram.png

´´´
@startuml
actor User
participant "User Service" as US
participant "Feed Service" as FS
participant "Ranking Service" as RS
participant "Real-Time Update Service" as RTUS

User -> US : Login
US -> FS : Request Feed
FS -> US : Get Friends
US -> FS : Return Friends
FS -> FS : Get Status Updates from Friends
FS -> RS : Rank Updates
RS -> FS : Return Ranked Updates
FS -> US : Return Feed
US -> User : Display Feed

User -> US : Post Status Update
US -> FS : Add Status Update
FS -> RTUS : Publish Update to Friends
RTUS -> FS : Update Friends' Feeds
@enduml
´´´

#### Non-functional requirements

- Scalability: Given the large number of users (100 million daily users, 1 million daily status updates), the system needs to be scalable. We could use a distributed database system and implement sharding and partitioning strategies to distribute data and load across multiple servers.

- Feed Generation/Refreshing: For feed generation, consider a pull model where feeds are generated when users log in or refresh their feeds. Given that we want new posts to show up quickly, it's important to optimize the feed refreshing process. Caching can also be used to improve feed load times.

- Data Persistence: To ensure that posts don't disappear, we need a robust data persistence strategy. This could involve database replication to protect against data loss if a single machine fails. Use of a distributed database with replication and failover mechanisms can help here.

- Real-Time Updates: Given the requirement for fast propagation of new posts, using a publish-subscribe model for real-time updates could be a good solution. When a user posts a status update, a message is published to a topic, and all of the user's friends who are subscribed to that topic receive the message.

- Global Audience: Given the global audience, latency and data locality should be considered. Users should be served from the nearest data center where possible. This can be achieved with a geo-distributed database and Content Delivery Network (CDN).

- Ads Integration (optional): If ads are incorporated, they could be treated as special types of posts that get inserted into the feed by the Ads Service and then ranked along with regular posts by the Ranking Service.

#### Sequence diagram ver 2 - with notes related to non-functional ideas

![Feed sequence diagram](https://github.com/skirtapaieo/system-design-101/blob/main/feed-seq-diagram-NFR.png)

https://github.com/skirtapaieo/system-design-101/blob/main/feed-seq-diagram-nfr.png

´´´
@startuml
actor User
participant "User Service" as US
participant "Feed Service" as FS
participant "Ranking Service" as RS
participant "Real-Time Update Service" as RTUS

User -> US : Login
US -> FS : Request Feed
note over FS : Scalability: Distributed database for user feeds
FS -> US : Get Friends
US -> FS : Return Friends
FS -> FS : Get Status Updates from Friends
FS -> RS : Rank Updates
RS -> FS : Return Ranked Updates
note over FS : Real-Time Updates: New posts propagate quickly
FS -> US : Return Feed
US -> User : Display Feed

User -> US : Post Status Update
note over US : Data Persistence: Status updates confirmed to user are reliably stored
US -> FS : Add Status Update
FS -> RTUS : Publish Update to Friends
RTUS -> FS : Update Friends' Feeds
@enduml

´´´

<br>

#### Requriements for each service

| Service                  | Description and Load                                                                                                                                                                   |
| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| User Service             | Handles user-related activities like authentication, profile edits, etc. Expected to handle millions of requests per day. Manages profile info and friend lists for 100M daily users.  |
| Feed Service             | Responsible for serving user feeds and processing status updates. Expected to handle billions of requests per day. Manages potentially 50B+ daily posts.                               |
| Ranking Service          | Handles the ranking of posts for user feeds. Expected to handle hundreds of millions to billions of ranking requests daily. Manages large amounts of metadata associated with ranking. |
| Real-Time Update Service | Responsible for processing and propagating real-time status updates to relevant user feeds. Expected to handle 500M update events daily. Manages large volumes of real-time data.      |

#### Requirements from post to ...

- ~10 KB per post
- ~1000 posts per news feed
- ~1 billion news feeds
- ~10 KB _ 1000 _ 1000^3 = 10 PB = 1000 \* 10 TB

#### Algoexpert system diagram

https://github.com/skirtapaieo/system-design-101/blob/main/facebook-system-diagram.svg
